(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{400:(e,t,a)=>{"use strict";a.d(t,{B:()=>u,ProjectProvider:()=>d});var o=a(5155),r=a(2115),l=a(9708),n=a(5567),s=a(1867);let i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id-";return e+Math.random().toString(36).slice(2,9)},c=(0,r.createContext)({projectId:null,projectData:null,projectsList:[],fetchProjectsList:async()=>{},createNewProject:async e=>null,loadProject:async()=>{},saveProject:async()=>{},updateEstimateData:e=>{},isLoaded:!1,isLoading:!0,isSaving:!1,isListLoading:!1});function d(e){let{children:t,initialProjectId:a=null}=e,{user:d}=(0,s.A)(),[u,p]=(0,r.useState)(a),[g,v]=(0,r.useState)(null),[f,h]=(0,r.useState)([]),[m,b]=(0,r.useState)(!1),[j,y]=(0,r.useState)(!1),[_,C]=(0,r.useState)(!1),[P,w]=(0,r.useState)(!1),[x,A]=(0,r.useState)("default-app-id");(0,r.useEffect)(()=>{void 0!==window.__app_id?A(window.__app_id):console.warn("__app_id not found, using default for ProjectContext.")},[]);let S=(0,r.useCallback)(()=>x&&"default-app-id"!==x?"artifacts/".concat(x,"/public/projects"):(console.error("Cannot get projects collection path: Missing appId."),null),[x]),k=(0,r.useCallback)(e=>S()&&e?"artifacts/".concat(x,"/public/projects/").concat(e):null,[S]),D=(0,r.useCallback)(async()=>{let e=S();if(e&&!_){console.log("Fetching projects list:",e),C(!0);try{let t=(0,l.P)((0,l.rJ)(n.db,e),(0,l.My)("updatedAt","desc")),a=(await (0,l.GG)(t)).docs.map(e=>{var t;return{id:e.id,name:e.data().name||"Untitled",updatedAt:null==(t=e.data().updatedAt)?void 0:t.toDate()}});h(a),console.log("Projects list fetched:",a.length)}catch(e){console.error("Error fetching projects list:",e),h([])}finally{C(!1)}}},[S,_,n.db]),E=(0,r.useCallback)(async e=>{let t=S();return d&&t&&!P||console.error("Cannot create project: User not logged in path or missing."),null},[d,S,P,n.db,D]),N=(0,r.useCallback)(async e=>{if(!e||j)return;let t=k(e);if(t){console.log("Loading project:",t),y(!0),b(!1),v(null),p(e);try{let a=(0,l.H9)(n.db,t),o=await (0,l.x7)(a);if(o.exists()){let t=o.data();t.estimateData||(t.estimateData={}),t.estimateData.levels&&0!==t.estimateData.levels.length||(t.estimateData.levels=[{id:i("level-"),name:"Level 1"}]),v(t),console.log("Project loaded:",e)}else console.log("No such project document! Cannot load:",e),p(null)}catch(t){console.error("Error loading project:",e,t),p(null)}finally{y(!1),b(!0)}}},[j,k,n.db]),I=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g;if(!d||!e||!t||P)return void console.error("Cannot save project: User not logged in or missing data/ID.");let a=k(e);if(a){console.log("Saving project:",a),w(!0);try{let o=(0,l.H9)(n.db,a),r={...t,updatedAt:l.Dc.now(),createdAt:t.createdAt||l.Dc.now()};await (0,l.BN)(o,r,{merge:!0}),v(r),console.log("Project saved successfully."),h(t=>t.map(t=>t.id===e?{...t,updatedAt:r.updatedAt.toDate()}:t).sort((e,t)=>t.updatedAt-e.updatedAt))}catch(e){console.error("Error saving project:",e)}finally{w(!1)}}},[d,u,g,P,k,n.db]),L=(0,r.useCallback)(e=>{v(t=>t?{...t,estimateData:{...t.estimateData,...e}}:null)},[]);(0,r.useEffect)(()=>{"default-app-id"!==x?D():(h([]),v(null),p(null))},[x,D]),(0,r.useEffect)(()=>{a&&!g&&!j&&(null==d?void 0:d.uid)&&N(a)},[a,g,j,null==d?void 0:d.uid,N]);let F=(0,r.useMemo)(()=>({projectId:u,projectData:g,projectsList:f,appId:x,fetchProjectsList:D,createNewProject:E,loadProject:N,saveProject:I,updateEstimateData:L,isLoaded:m,isLoading:j,isSaving:P,isListLoading:_}),[u,g,f,D,E,N,I,L,m,j,P,_]);return(0,o.jsx)(c.Provider,{value:F,children:t})}let u=()=>(0,r.useContext)(c)},1867:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,AuthProvider:()=>i});var o=a(5155),r=a(2115),l=a(2553),n=a(5567);let s=(0,r.createContext)({user:void 0,loading:!0,signIn:async()=>{},signOutUser:async()=>{}});function i(e){let{children:t}=e,[a,i]=(0,r.useState)(void 0),c=void 0===a,d=async()=>{try{await (0,l.df)(n.j2,n.hJ)}catch(e){console.error("Error signing in with Google:",e)}},u=async()=>{try{await (0,l.CI)(n.j2)}catch(e){console.error("Error signing out:",e)}};(0,r.useEffect)(()=>{let e=(0,l.hg)(n.j2,e=>{console.log("Auth State Changed:",(null==e?void 0:e.uid)||"No user"),i(e)});return()=>e()},[]);let p=(0,r.useMemo)(()=>({user:a,loading:c,signIn:d,signOutUser:u}),[a,c]);return(0,o.jsx)(s.Provider,{value:p,children:t})}let c=()=>(0,r.useContext)(s)},3673:()=>{},3867:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}},3868:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(5155),r=a(1867);function l(e){let{children:t}=e,{loading:a}=(0,r.A)();return a?(0,o.jsx)("div",{style:{padding:24,textAlign:"center",marginTop:"50px"},children:"Loading Authentication..."}):(0,o.jsx)(o.Fragment,{children:t})}},5567:(e,t,a)=>{"use strict";a.d(t,{db:()=>s,hJ:()=>c,j2:()=>i});var o=a(2078),r=a(9708),l=a(2553);let n=(0,o.Dk)().length?(0,o.Sx)():(0,o.Wp)({apiKey:"AIzaSyBWK-vjvOLq1O5p_3uk1Jxr48hf0eo3kCw",authDomain:"inventory-estimator.firebaseapp.com",projectId:"inventory-estimator",storageBucket:"inventory-estimator.firebasestorage.app",messagingSenderId:"867265758215",appId:"1:867265758215:web:54f62bc943ebb1965a16a2"}),s=(0,r.aU)(n),i=(0,l.xI)(n),c=new l.HF},8750:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,3867,23)),Promise.resolve().then(a.t.bind(a,9672,23)),Promise.resolve().then(a.t.bind(a,3673,23)),Promise.resolve().then(a.bind(a,1867)),Promise.resolve().then(a.bind(a,3868)),Promise.resolve().then(a.bind(a,400))},9672:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}}},e=>{e.O(0,[538,135,965,240,441,255,358],()=>e(e.s=8750)),_N_E=e.O()}]);