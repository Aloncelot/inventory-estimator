(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,88274,e=>{"use strict";e.s(["AuthProvider",()=>n,"useAuth",()=>s]);var t=e.i(43476),o=e.i(71645);e.i(51718);var a=e.i(18357),l=e.i(21052);let r=(0,o.createContext)({user:void 0,loading:!0,signIn:async()=>{},signOutUser:async()=>{}});function n(e){let{children:n}=e,[s,i]=(0,o.useState)(void 0),c=void 0===s,u=async()=>{try{await (0,a.signInWithPopup)(l.auth,l.googleProvider)}catch(e){console.error("Error signing in with Google:",e)}},d=async()=>{try{await (0,a.signOut)(l.auth)}catch(e){console.error("Error signing out:",e)}};(0,o.useEffect)(()=>{let e=(0,a.onAuthStateChanged)(l.auth,e=>{console.log("Auth State Changed:",(null==e?void 0:e.uid)||"No user"),i(e)});return()=>e()},[]);let g=(0,o.useMemo)(()=>({user:s,loading:c,signIn:u,signOutUser:d}),[s,c]);return(0,t.jsx)(r.Provider,{value:g,children:n})}let s=()=>(0,o.useContext)(r)},87940,e=>{"use strict";e.s(["ProjectProvider",()=>i,"useProject",()=>c]);var t=e.i(43476),o=e.i(71645);e.i(36180);var a=e.i(98925),l=e.i(21052),r=e.i(88274);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id-";return e+Math.random().toString(36).slice(2,9)},s=(0,o.createContext)({projectId:null,projectData:null,projectsList:[],fetchProjectsList:async()=>{},createNewProject:async e=>null,loadProject:async()=>{},saveProject:async()=>{},updateEstimateData:e=>{},isLoaded:!1,isLoading:!0,isSaving:!1,isListLoading:!1});function i(e){let{children:i,initialProjectId:c=null}=e,{user:u}=(0,r.useAuth)(),[d,g]=(0,o.useState)(c),[p,h]=(0,o.useState)(null),[v,f]=(0,o.useState)([]),[j,m]=(0,o.useState)(!1),[y,A]=(0,o.useState)(!1),[C,b]=(0,o.useState)(!1),[P,D]=(0,o.useState)(!1),[S,x]=(0,o.useState)(null);(0,o.useEffect)(()=>{u?x(u.uid):x(null)},[u]);let E=(0,o.useCallback)(()=>S?"artifacts/".concat(S,"/projects"):(console.error("Cannot get projects collection path: Missing appId."),null),[S]),w=(0,o.useCallback)(e=>E()&&e?"artifacts/".concat(S,"/projects/").concat(e):null,[E]),L=(0,o.useCallback)(async()=>{let e=E();if(e&&!C){console.log("Fetching projects list:",e),b(!0);try{let t=(0,a.query)((0,a.collection)(l.db,e),(0,a.orderBy)("updatedAt","desc")),o=(await (0,a.getDocs)(t)).docs.map(e=>{var t;return{id:e.id,name:e.data().name||"Untitled",updatedAt:null==(t=e.data().updatedAt)?void 0:t.toDate()}});f(o),console.log("Projects list fetched:",o.length)}catch(e){console.error("Error fetching projects list:",e),f([])}finally{b(!1)}}},[E,l.db]),k=(0,o.useCallback)(async e=>{let t=E();return u&&t&&!P||console.error("Cannot create project: User not logged in path or missing."),null},[u,E,l.db,L]),T=(0,o.useCallback)(async e=>{if(!e||y)return;let t=w(e);if(t){console.log("Loading project:",t),A(!0),m(!1),h(null),g(e);try{let o=(0,a.doc)(l.db,t),r=await (0,a.getDoc)(o);if(r.exists()){let t=r.data();t.estimateData||(t.estimateData={}),t.estimateData.levels&&0!==t.estimateData.levels.length||(t.estimateData.levels=[{id:n("level-"),name:"Level 1"}]),h(t),console.log("Project loaded:",e)}else console.log("No such project document! Cannot load:",e),g(null)}catch(t){console.error("Error loading project:",e,t),g(null)}finally{A(!1),m(!0)}}},[w,l.db]),U=(0,o.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p;if(!u||!e||!t||P)return void console.error("Cannot save project: User not logged in or missing data/ID.");let o=w(e);if(o){console.log("Saving project:",o),D(!0);try{let r=(0,a.doc)(l.db,o),n={...t,updatedAt:a.Timestamp.now(),createdAt:t.createdAt||a.Timestamp.now()};await (0,a.setDoc)(r,n,{merge:!0}),h(n),console.log("Project saved successfully."),f(t=>t.map(t=>t.id===e?{...t,updatedAt:n.updatedAt.toDate()}:t).sort((e,t)=>t.updatedAt-e.updatedAt))}catch(e){console.error("Error saving project:",e)}finally{D(!1)}}},[u,d,p,w,l.db]),I=(0,o.useCallback)(e=>{h(t=>t?{...t,estimateData:{...t.estimateData,...e}}:null)},[]);(0,o.useEffect)(()=>{S?L():(f([]),h(null),g(null))},[S,L]),(0,o.useEffect)(()=>{c&&!p&&!y&&(null==u?void 0:u.uid)&&T(c)},[c,p,y,null==u?void 0:u.uid,T]);let M=(0,o.useMemo)(()=>({projectId:d,projectData:p,projectsList:v,appId:S,fetchProjectsList:L,createNewProject:k,loadProject:T,saveProject:U,updateEstimateData:I,isLoaded:j,isLoading:y,isSaving:P,isListLoading:C}),[d,p,v,L,k,T,U,I,j,y,P,C]);return(0,t.jsx)(s.Provider,{value:M,children:i})}let c=()=>(0,o.useContext)(s)},87536,e=>{"use strict";e.s(["default",()=>a]);var t=e.i(43476),o=e.i(88274);function a(e){let{children:a}=e,{loading:l}=(0,o.useAuth)();return l?(0,t.jsx)("div",{style:{padding:24,textAlign:"center",marginTop:"50px"},children:"Loading Authentication..."}):(0,t.jsx)(t.Fragment,{children:a})}}]);